#!/bin/bash

###########################################
# Project : Pentesting_Quickstart
# Element : Pentesting_Quick_Toolkit
# Version : 1.0.0

###########################################
# Author : Connor Maddison
# Date : 05/25/2022

###########################################

targetIp=""
reportingDir=""

Boot()
{

#############################
#Commands that run as comand is launched
#Preps the system
#############################

	#Check that xterm is installed for commands to function
	xtermFinder=$(find / -name xterm 2>/dev/null)
	found=false
	
	if "/usr/bin/xterm" in $xtermFinder
	then
		found=true
	else
		echo "xterm not located, please install"
		found=false
		exit 2
	fi
		
	#Load in the previously used targets for quickly returning
	targetIp=$(<~/Documents/Pentesting_Quickstart/targetIp.txt)
	reportingDir=$(<~/Documents/Pentesting_Quickstart/ReportingDir.txt)
	DirCheck
}

DirCheck()
{

#############################
#If ~ is used replace it with current user so that programs dont error
#############################

	#get current user
	user=$(whoami)
	#replace ~ with their home dir
	reportingDir=${reportingDir/"~"/"/home/$user"}
	
	#add relevent dirs to reporting space
	ReportingDirTemplate
}

Menu()
{

#############################
# Initial menu for setting target and reporting location
#############################

	echo "--------------------------------------"
	echo "Targeting IP : " $targetIp
	echo "Reporting to : "$reportingDir

	accept=false
	
	#loop untill an option is selected
	while [ $accept == false ]
	do
		echo "--------------------------------------"
		echo "Would you like to change this?"
		echo "[0] - Keep Target"
		echo "[1] - Change Target"
		echo "--------------------------------------"
		read responce
		

		if [ $responce == 0 ] 
		then
			echo "Keeping Target"
			echo "--------------------------------------"
			accept=true
		elif [ $responce == 1 ]
		then
			echo "Changing Target"
			echo "--------------------------------------"
			SetTarget
			accept=true	
		elif [ $responce == "q" ] || [ $responce == "c" ]
		then
			echo "quitting program"
			exit 0
		else
			echo "Incorrect Input"
		fi
	done
	
	#link to choices
	MainOptions

}

MainOptions()
{

#############################
#This is where all the commands are stored
#e.g. nmap, feroxbuster, etc...
#############################

	
	#loop forever
	while true
	do
	
#Menu for choices
echo -e "
--------------------------------------
What would you like to do?

[q] or [c] - Quit
--------------------------------------
[0] - Print Target
[1] - Change Target
[2] - Nmap Recon
[3] - Nc Listener
[4] - Dictionary Cleaner
[5] - WebBuster
--------------------------------------"
		read choice
		
		#list of choices
		case $choice in

			0) # Print target again
				echo "--------------------------------------"
				echo "Targeting IP : " $targetIp
				echo "Reporting to : "$reportingDir
				echo "--------------------------------------"
			;;
			
			1) # Change target
				echo "Changing Target"
				echo "--------------------------------------"
				SetTarget
			;;
			
			2) # run default NMAP recon scan
				echo "--------------------------------------"
				ScanTarget
			;;
			
			3) # run NC listener
				echo "--------------------------------------"
				NcListener
			;;
			
			4) # run dictionary cleaner
				echo "--------------------------------------"
				DictionaryClean
			;;
			
			5) # run default feroxbuster scan
				echo "--------------------------------------"
				WebBuster
			;;
			
			q | c) # quit program
				exit 0
			;;
			

			*) # if incorrect imput tell user
			   	echo "Incorrect Input"
			;;
		esac

	done
}


SetTarget()
{

#############################
#set the target IP and reporting dir
#############################

	echo "Enter Target IP: "
	read targetIp 
	echo $targetIp > ~/Documents/Pentesting_Quickstart/targetIp.txt
	echo "Set Reporting Directory (must end in / ): "
	read -e reportingDir dir
	DirCheck
	echo $reportingDir > ~/Documents/Pentesting_Quickstart/ReportingDir.txt
	echo "--------------------------------------"
	echo "Targeting IP : " $targetIp
	echo "Reporting to : "$reportingDir
	echo "--------------------------------------"
	
}

ReportingDirTemplate()
{

#############################
#make the dir repositories required for reporting
#############################

	#don't show error if dir exists
	mkdir $reportingDir"nmap_scans" 2>/dev/null	
	mkdir $reportingDir"dictionaries" 2>/dev/null
	mkdir $reportingDir"web_busts" 2>/dev/null
	
}

FileFormatter()
{

#############################
#Repeatable source to format files the same way consistently
#$1 = dir+identafiable name e.g.nmap_scans/Nmap_Recon_Scan.xml
#############################
	
	
	path=$(echo $1)
	
	
	filename=$reportingDir$path
	
	echo $filename
	

}

ScanTarget()
{

#############################
#Run nmap scan in new xterm terminal
#Default detection scan (minimal perameters)
#Print command so it can be coppied from terminal easily
#############################

	#readable file naming
	filename=$(FileFormatter "nmap_scans/Nmap_Recon_Scan_$(date +"%H_%M_%h_%d").xml")
	
	
	command="nmap -sC -sV -v $targetIp -oX $filename;"
	
	#print command
	echo "running command : $command "
	echo "saving to : $filename"
	
	#launch in terminal
	xterm -e "$command echo -n  \"\n\nTask Complete : [press any key to close]\"; read line" &
}

NcListener()
{

#############################
#Open a netcat lisener on entered port
#############################

	echo "Set the port to listen on"
	read port
	
	command="nc -lnvp $port;"
	
	#print command
	echo "running command : $command "
	echo "Opening on port : $port"
	
	#launch in terminal
	xterm -e "$command echo -n  \"\n\nTask Complete : [press any key to close]\"; read line" &

}

DictionaryClean()
{

#############################
#Sort and Unique dictionary to make it quicker to brute
#############################

	echo "select dictionary (full directory name)"
	read -e file
	
	file_clean=${file/"~"/"/home/$user"} # change ~ into /home/usr
	
	
	#get the name of the file and split it into its name and extention
	name=$(echo $file | rev | cut -d/ -f1 | rev)
	open=$(echo $name | cut -d. -f1)
	ext=$(echo $name | rev | cut -d. -f1 | rev)
	
	
	filename=$(FileFormatter "dictionaries/$open""_Cleaned.$ext")
	
	
	command="sort $file_clean | uniq > $filename;"
	
	#print command
	echo "running command : $command "
	echo "saving to : $filename"
	
	#launch in terminal
	xterm -e "$command echo -n  \"\n\nTask Complete : [press any key to close]\"; read line" &
	
}

WebBuster()
{

#############################
#Crawl address for extensions
#############################

		
	accept=false
	targetURL=""
	
	#loop untill an option is selected
	while [ $accept == false ]
	do
		echo "Would you like to search target IP or a specific address"
		echo "[0] - target IP"
		echo "[1] - specific address"
		echo "--------------------------------------"
		read responce
		

		if [ $responce == 0 ] 	#use target IP to search
		then
			echo "Keeping Target"
			echo "--------------------------------------"
			targetURL=$targetIp 
			accept=true
		elif [ $responce == 1 ]	#Search a specific URL (domain assosiated with IP)
		then
			echo "Changing Target"
			echo "--------------------------------------"
			echo "enter address URL : "
			read url
			targetURL=$url 
			accept=true	
		elif [ $responce == "q" ] || [ $responce == "c" ]
		then
			echo "quitting program"
			return 0
		else
			echo "Incorrect Input"
		fi
	done
	
	filename=$(FileFormatter "web_busts/Web_Extensions_$(date +"%H_%M_%h_%d").txt")
	
	
	command="feroxbuster -u $targetURL -x html,php,js,py,css > $filename;" #scan against common web extentions
	
	#print command
	echo "running command : $command "
	echo "saving to : $filename"
	
	#launch in terminal
	xterm -e "$command echo -n  \"\n\nTask Complete : [press any key to close]\"; read line" &


}

Boot
Menu
